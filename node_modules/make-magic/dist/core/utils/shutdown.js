"use strict";var __awaiter=this&&this.__awaiter||function(t,e,s,o){return new(s||(s=Promise))((function(n,a){function u(t){try{i(o.next(t))}catch(t){a(t)}}function r(t){try{i(o.throw(t))}catch(t){a(t)}}function i(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(u,r)}i((o=o.apply(t,e||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useGracefulShutdown=exports.removeShutdownTask=exports.addShutdownTask=exports.ShutdownSignals=void 0,exports.ShutdownSignals=["SIGHUP","SIGINT","SIGQUIT","SIGILL","SIGTRAP","SIGABRT","SIGBUS","SIGFPE","SIGSEGV","SIGUSR1","SIGUSR2","SIGTERM"];const state={tasks:new Set,isShuttingDown:!1};function addShutdownTask(t){state.tasks.add(t)}function removeShutdownTask(t){state.tasks.delete(t)}function useGracefulShutdown(){process.stdin.resume(),exports.ShutdownSignals.forEach((t=>{process.on(t,(()=>__awaiter(this,void 0,void 0,(function*(){if(state.isShuttingDown)return;state.isShuttingDown=!0;const e=[...state.tasks.values()].map((e=>Promise.resolve(e(t))));yield Promise.all(e),process.exit()}))))}))}exports.addShutdownTask=addShutdownTask,exports.removeShutdownTask=removeShutdownTask,exports.useGracefulShutdown=useGracefulShutdown;