"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(a,n){function l(e){try{o(i.next(e))}catch(e){n(e)}}function s(e){try{o(i.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,s)}o((i=i.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseFlags=void 0;const decamelize_1=__importDefault(require("../compiled/decamelize")),yargs_parser_1=__importDefault(require("../compiled/yargs-parser")),errors_warnings_1=require("./utils/errors-warnings"),filter_nil_values_1=require("./utils/filter-nil-values");function parseFlags(e,t){return __awaiter(this,void 0,void 0,(function*(){const r=!!t,i={},a=[];Object.entries(e).forEach((([e,t])=>{t.alias&&(i[e]=[t.alias]),t.type===Boolean&&a.push(e)}));const n=null!=t?t:yargs_parser_1.default(process.argv.slice(2),{alias:i,boolean:a}),l=getFlagDefaults(e),s=yield validateFlagInputs(e,n),o=Object.assign(Object.assign({},l),s);if(r){const t=Object.keys(e).filter((t=>null==e[t].default)),r=Object.keys(n),i=t.map((e=>{if(!r.includes(e))return e})).filter(Boolean);if(i.length)throw errors_warnings_1.createValidationError(`Missing required template data (${i.join(", ")})`)}return o}))}function getFlagDefaults(e){return filter_nil_values_1.filterNilValues(Object.fromEntries(Object.keys(e).filter((t=>null!=e[t].default)).map((t=>{const r=e[t];return[t,"function"==typeof r.default?r.default():r.default]}))))}function validateFlagInputs(e,t={}){return __awaiter(this,void 0,void 0,(function*(){return filter_nil_values_1.filterNilValues(Object.fromEntries(yield Promise.all(Object.entries(t).map((([t,r])=>__awaiter(this,void 0,void 0,(function*(){var i;const a=e[t];if(a){const e=a.type;let n;n=Array.isArray(e)?Array.isArray(r)?r.map((t=>e[0](t))):[e[0](r)]:Array.isArray(r)?e(r[r.length-1]):e(r);const l=yield null===(i=null==a?void 0:a.validate)||void 0===i?void 0:i.call(a,n);if(l&&"string"==typeof l)throw errors_warnings_1.createValidationError(l);if(!l&&"boolean"==typeof l)throw errors_warnings_1.createValidationError(`--${decamelize_1.default(t,{separator:"-"})} received invalid input.`);return[t,null!=n?n:"function"==typeof a.default?a.default():a.default]}return[t,void 0]})))))))}))}exports.parseFlags=parseFlags;